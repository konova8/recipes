#!/bin/sh

# --- Update recipe cards in index.html between marker comments ---
# Instead of regenerating the entire file, this replaces only the
# <!-- RECIPES:START --> ... <!-- RECIPES:END --> block.

# Build the new recipe list into a temp file
TMPFILE=$(mktemp)

echo "<!-- RECIPES:START -->" > "$TMPFILE"

for f in ./*.md ./.*.md; do
    [ -f "$f" ] || continue
    n="$(basename "$f" .md)"
    title="$(echo "$n" | tr '-' ' ')"
    echo "            <li><a class=\"card\" href=\"${f%.md}\"><div class=\"card-icon\">üç≤</div><div class=\"card-title\">${title}</div></a></li>" >> "$TMPFILE"
done

echo "<!-- RECIPES:END -->" >> "$TMPFILE"

# Replace everything between the markers (inclusive) with the new content
sed -i '' '/<!-- RECIPES:START -->/,/<!-- RECIPES:END -->/{
    /<!-- RECIPES:START -->/{
        r '"$TMPFILE"'
        d
    }
    /<!-- RECIPES:END -->/d
    d
}' ./index.html

rm -f "$TMPFILE"

git add index.html

exit 0
